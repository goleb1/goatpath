<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Debug</title>
</head>
<body>
    <h1>Firebase Authentication Debug</h1>
    <div id="status">Checking authentication...</div>
    <div id="user-info"></div>
    <div id="rules-test"></div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Your Firebase config (replace with your actual values)
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://your-project-default-rtdb.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Check authentication status
        onAuthStateChanged(auth, (user) => {
            const statusDiv = document.getElementById('status');
            const userInfoDiv = document.getElementById('user-info');
            
            if (user) {
                statusDiv.innerHTML = '✅ User is authenticated';
                userInfoDiv.innerHTML = `
                    <h3>User Info:</h3>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>UID:</strong> ${user.uid}</p>
                    <p><strong>Email Verified:</strong> ${user.emailVerified}</p>
                `;
                
                // Test database write
                testDatabaseWrite();
            } else {
                statusDiv.innerHTML = '❌ User is NOT authenticated';
                userInfoDiv.innerHTML = '<p>Please log in to the admin portal first</p>';
            }
        });

        async function testDatabaseWrite() {
            const testDiv = document.getElementById('rules-test');
            testDiv.innerHTML = 'Testing database write...';
            
            try {
                const testRef = ref(database, 'event/test');
                await set(testRef, {
                    test: true,
                    timestamp: new Date().toISOString()
                });
                testDiv.innerHTML = '✅ Database write successful - Rules are working!';
            } catch (error) {
                testDiv.innerHTML = `❌ Database write failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>
